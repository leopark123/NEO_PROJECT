# 🔒 NEO 项目 · AI 单兵执行宪章 v1.1

> **地位**：最高指令文件，高于任何对话、高于临时代码想法  
> **用途**：上下文被压缩后，重新加载这一页即可继续开发  
> **状态**：🔒 已冻结（含3个审计护栏）

---

## 0. 会话启动规则（最重要）

**每次新会话或上下文压缩后，Claude Code 必须：**

1. **第一步**：读取 `PROJECT_STATE.md`，确认当前进度
2. **第二步**：读取本宪章
3. **第三步**：读取最近的 Checkpoint（如有）
4. **然后**：从 PROJECT_STATE 记录的位置继续执行

**禁止**：不看 PROJECT_STATE 就开始写代码

---

## 1. 角色定义

| 角色 | 职责 |
|------|------|
| **Claude Code** | 唯一代码执行者 |
| **人类（指挥官）** | 规格冻结、决策、验收 |

**禁止**：Claude Code 自行推断医学、协议、阈值含义

---

## 2. 不可违背的工程铁律（Hard Rules）

### 2.1 医学意义优先
- EEG / aEEG 算法仅按 SDS / ICD / MR 文档实现
- **不允许**"近似实现 / 合理推断 / 简化版本"

### 2.2 时间体系
- EEG、NIRS、Video **统一使用主机时间戳**
- 单位：`int64 微秒 (μs)`
- **禁止**混用设备时间戳

### 2.3 数据真实性
- EEG 波形必须真实反映采集数据
- **不得**平滑、伪造、自动补点

### 2.4 NIRS 模块
- 单位 / 阈值 **仅来自设备说明**
- 软件**不得**自行计算或推断

### 2.5 存储原则
- 单患者
- FIFO 删除
- 达到容量上限自动删除最早数据（无提示，必记录日志）

---

## 3. 存储延迟实现声明（审计护栏）⚠️

> **在未进入 Storage Sprint (S4) 前，所有数据只允许：**
> - 内存缓存
> - 文件顺序写入（append-only）
> 
> **不允许引入任何 DB schema。**

这是为了防止"提前优化"。

---

## 4. 强制 Checkpoint 机制（生死线）

**每完成一个功能模块，必须：**

1. 生成 Checkpoint 文档：`checkpoints/CP-XX-<module>.md`
2. 更新 `PROJECT_STATE.md`

**否则该功能视为未完成。**

---

## 5. 功能级自检模板（审计护栏）⚠️

**每完成一个功能，必须填写以下自检清单：**

```markdown
## Self-Check (Mandatory)

- [ ] 实现是否完全来自文档？（列出文档名+章节）
- [ ] 是否引入任何推测？（如有 → 标记 ADR 或 UNKNOWN）
- [ ] 是否改变已有接口 / 数据结构？
- [ ] 是否影响时间戳一致性？
- [ ] 是否可被回放复现？
- [ ] 是否更新了 PROJECT_STATE.md？
```

**不是增加负担，是防止"看起来对但其实不严谨"**

---

## 6. 自检的硬性要求（不可省略）

| 要求 | 示例 |
|------|------|
| ✅ 引用具体文件路径 | `src/Core/Time/GlobalClock.cs:L45` |
| ✅ 明确状态 | 已实现 / 未实现 / UNKNOWN |
| ❌ 禁止模糊词 | ~~合理、通常、应该、大致~~ |

---

## 7. 允许暂停 / 恢复

- 任意时刻可中断开发
- 重启时只需加载：
  1. **PROJECT_STATE.md**（进度锚点）
  2. **本宪章**
  3. **最近一个 Checkpoint**

---

## 8. 15条铁律速查

| # | 铁律 |
|---|------|
| 1 | Raw数据只读 |
| 2 | 不伪造波形 |
| 3 | ZoomOut用Min/Max |
| 4 | 滤波器用double |
| 5 | 缺失/饱和有标记 |
| 6 | 渲染线程只Draw |
| 7 | 时间戳int64μs |
| 8 | 参数可追溯 |
| 9 | 协议与ICD一致 |
| 10 | 必须有单元测试 |
| 11 | 异常必须记录 |
| 12 | 数据完整性验证 |
| 13 | 存储前向兼容 |
| 14 | 患者数据加密 |
| 15 | 审计日志防篡改 |

---

## 9. 恢复开发的最小指令

```
【恢复模式】

1. 读取 PROJECT_STATE.md（确认进度）
2. 读取 spec/CHARTER.md（本文件）
3. 读取最近的 checkpoints/CP-xx.md

从 PROJECT_STATE 记录的位置继续执行。
每完成功能必须更新 PROJECT_STATE.md。
```

---

**🔒 END OF CHARTER v1.1**

> **你现在已经有资格说这句话了：**
> **"可以开始写代码，但必须在我的规则里。"**
