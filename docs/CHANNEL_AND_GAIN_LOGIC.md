# NEO é€šé“è®¾ç½®ä¸å¢ç›Šæ§åˆ¶é€»è¾‘è¯¦ç»†è¯´æ˜

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
> **æœ€åæ›´æ–°**: 2026-02-07
> **é€‚ç”¨èŒƒå›´**: UI Phase 3 æ³¢å½¢æ¸²æŸ“ç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

1. [é€šé“è®¾ç½®é€»è¾‘](#1-é€šé“è®¾ç½®é€»è¾‘)
2. [å¢ç›Šè®¾ç½®é€»è¾‘](#2-å¢ç›Šè®¾ç½®é€»è¾‘)
3. [æ•°æ®æµå‘å›¾](#3-æ•°æ®æµå‘å›¾)
4. [ä»£ç å®ç°æ£€æŸ¥](#4-ä»£ç å®ç°æ£€æŸ¥)
5. [è§„æ ¼ç¬¦åˆæ€§éªŒè¯](#5-è§„æ ¼ç¬¦åˆæ€§éªŒè¯)
6. [å·²çŸ¥é—®é¢˜ä¸é™åˆ¶](#6-å·²çŸ¥é—®é¢˜ä¸é™åˆ¶)

---

## 1. é€šé“è®¾ç½®é€»è¾‘

### 1.1 é€šé“é…ç½®æ¦‚è¿°

**ç¡¬ä»¶é‡‡é›†é€šé“**: 4 é€šé“ï¼ˆCH1-CH4ï¼‰
**æ˜¾ç¤ºé€šé“æ•°**: 2 é€šé“ï¼ˆåŒæ—¶æ˜¾ç¤ºï¼Œå¯åˆ‡æ¢ç»„åˆï¼‰
**é‡‡æ ·ç‡**: 160 Hz

### 1.2 å¯¼è”ç»„åˆï¼ˆLead Combinationï¼‰

#### å¯é€‰ç»„åˆï¼ˆç¡¬ä»¶çº¦æŸï¼‰

**å½“å‰æ”¯æŒ** (æˆªè‡³ 2026-02-08):

| é€‰é¡¹ | CH1 å¯¼è” | CH2 å¯¼è” | è¯´æ˜ | ç‰©ç†é€šé“æ˜ å°„ |
|------|---------|---------|------|------------|
| **C3-P3 / C4-P4** (é»˜è®¤) | C3-P3 | C4-P4 | æ ‡å‡†åŒåŠçƒç›‘æµ‹ | ç‰©ç† CH1/CH2 |

**ç¡¬ä»¶é™åˆ¶**: ä»…æ”¯æŒä¸Šè¿°ç»„åˆï¼Œå› ä¸ºç¡¬ä»¶åªæä¾› 4 ä¸ªå›ºå®šç”µæ (C3, P3, C4, P4)ã€‚
ä¸æ”¯æŒ F3-P3/F4-P4 æˆ– C3-O1/C4-O2 ç»„åˆï¼ˆç¡¬ä»¶æ—  F3/F4/O1/O2 ç”µæï¼‰ã€‚

è¯¦è§: `spec/CONSENSUS_BASELINE.md:205-208`, `src/Core/Models/EegSample.cs:20-24`

#### å®ç°ä½ç½®

**å®šä¹‰**: `src/UI/ViewModels/WaveformViewModel.cs:14-19`

```csharp
// Hardware-supported lead combinations only
public static IReadOnlyList<LeadCombinationOption> LeadCombinationOptions { get; } =
[
    new("C3-P3 / C4-P4", "C3-P3", "C4-P4")  // Maps to physical CH1/CH2
];
```

#### UI ç»‘å®š

**XAML**: `src/UI/Views/Controls/ChannelControlPanel.xaml:17-27`

```xml
<ComboBox ItemsSource="{Binding LeadCombinationOptions}"
          SelectedItem="{Binding SelectedLeadCombination, Mode=TwoWay}">
    <ComboBox.ItemTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding Label}"/>
        </DataTemplate>
    </ComboBox.ItemTemplate>
</ComboBox>
```

**æ˜¾ç¤ºæ ‡ç­¾**: `ChannelControlPanel.xaml:28-35`

```xml
<TextBlock Text="{Binding LeadCh1}"  <!-- "CH1: C3-P3" -->
           Foreground="{StaticResource TextDarkTertiaryBrush}"/>
<TextBlock Text="{Binding LeadCh2}"  <!-- "CH2: C4-P4" -->
           Foreground="{StaticResource TextDarkTertiaryBrush}"/>
```

### 1.3 é€šé“åˆ‡æ¢é€»è¾‘

#### å˜æ›´ç›‘å¬å™¨

**ä½ç½®**: `WaveformViewModel.cs:81-96`

```csharp
partial void OnSelectedLeadCombinationChanged(LeadCombinationOption? oldValue, LeadCombinationOption? newValue)
{
    if (newValue is null)
    {
        return;
    }

    // æ›´æ–°æ˜¾ç¤ºæ ‡ç­¾
    LeadCh1 = $"CH1: {newValue.Ch1}";  // ä¾‹: "CH1: C3-P3"
    LeadCh2 = $"CH2: {newValue.Ch2}";  // ä¾‹: "CH2: C4-P4"

    // è®°å½•å®¡è®¡äº‹ä»¶ (2026-02-08 æ–°å¢)
    if (oldValue != null && oldValue.Label != newValue.Label)
    {
        _audit.Log(AuditEventTypes.LeadChange, $"{oldValue.Label} -> {newValue.Label}");
    }
}
```

#### å¾ªç¯åˆ‡æ¢å‘½ä»¤

**ä½ç½®**: `WaveformViewModel.cs:165-184`

```csharp
[RelayCommand]
private void CycleLeadCombination()
{
    if (SelectedLeadCombination is null)
    {
        SelectedLeadCombination = LeadCombinationOptions[0];
        return;
    }

    // æŸ¥æ‰¾å½“å‰ç´¢å¼•å¹¶å¾ªç¯åˆ°ä¸‹ä¸€ä¸ªç»„åˆ
    int index = 0;
    for (int i = 0; i < LeadCombinationOptions.Count; i++)
    {
        if (LeadCombinationOptions[i].Label == SelectedLeadCombination.Label)
        {
            index = i;
            break;
        }
    }

    SelectedLeadCombination = LeadCombinationOptions[(index + 1) % LeadCombinationOptions.Count];
}
```

**è§¦å‘æ–¹å¼**:
- UI ComboBox é€‰æ‹©
- å¿«æ·é”®è°ƒç”¨ `CycleLeadCombinationCommand`

### 1.4 é€šé“æ˜ å°„åˆ°æ¸²æŸ“

**å½“å‰å®ç°** (2026-02-08): å¯¼è”ç»„åˆåˆ‡æ¢ä¼š**åŒæ—¶æ›´æ–°æ˜¾ç¤ºæ ‡ç­¾å’Œå®é™…æ•°æ®æºæ˜ å°„**ã€‚

#### æ•°æ®æµ

1. **UI å±‚**: ç”¨æˆ·é€‰æ‹©å¯¼è”ç»„åˆ â†’ `SelectedLeadCombination` å˜æ›´
2. **ViewModel å±‚**: `OnSelectedLeadCombinationChanged` æ›´æ–°æ ‡ç­¾ + è®°å½•å®¡è®¡
3. **View å±‚**: `WaveformPanel.OnPropertyChanged` ç›‘å¬å˜æ›´
4. **æ˜ å°„å±‚**: `ApplyLeadCombinationMapping` è°ƒç”¨ `EegDataBridge.SetChannelMapping(ch1, ch2)`
5. **æ•°æ®å±‚**: `GetSweepData()` æ ¹æ®æ˜ å°„è¿”å›å¯¹åº”ç‰©ç†é€šé“æ•°æ®

**å…³é”®ä»£ç **:
- æ˜ å°„è®¾ç½®: `src/UI/Rendering/EegDataBridge.cs:202-209` (`SetChannelMapping`)
- æ˜ å°„åº”ç”¨: `src/UI/Rendering/EegDataBridge.cs:331-358` (`GetSweepData`)
- UI ç»‘å®š: `src/UI/Views/Controls/WaveformPanel.xaml.cs:164-180`

**ä¿è¯**:
- âœ… æ ‡ç­¾ä¸æ•°æ®ä¸€è‡´ï¼ˆ`ChannelName` åæ˜ å®é™… `Samples` æ¥æºï¼‰
- âœ… å›å½’æµ‹è¯•è¦†ç›–ï¼ˆ`LeadLabelConsistency_PreventsClinicalMislabeling`ï¼‰
- âœ… å®¡è®¡äº‹ä»¶è®°å½•ï¼ˆ`LEAD_CHANGE`ï¼‰

---

## 2. å¢ç›Šè®¾ç½®é€»è¾‘

### 2.1 å¢ç›Šæ¦‚å¿µ

**å®šä¹‰**: å¢ç›Šï¼ˆGainï¼‰æ§åˆ¶ EEG æ³¢å½¢çš„å‚ç›´ç¼©æ”¾ï¼Œå•ä½ä¸º **Î¼V/cm**

**ç‰©ç†æ„ä¹‰**:
- 100 Î¼V/cm = æ¯ 1 cm å±å¹•é«˜åº¦è¡¨ç¤º 100 Î¼V ç”µå‹
- **å¢ç›Šè¶Šä½ â†’ çµæ•åº¦è¶Šé«˜ â†’ æ³¢å½¢è¶Šå¤§**
- **å¢ç›Šè¶Šé«˜ â†’ çµæ•åº¦è¶Šä½ â†’ æ³¢å½¢è¶Šå°**

**è§„æ ¼**: `spec/UI_SPEC.md:218`

### 2.2 å¢ç›Šæ¡£ä½

#### å¯é€‰æ¡£ä½

| æ¡£ä½ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **10 Î¼V/cm** | æé«˜çµæ•åº¦ | æä½å¹…åº¦ä¿¡å· |
| **20 Î¼V/cm** | å¾ˆé«˜çµæ•åº¦ | ä½å¹…åº¦ä¿¡å· |
| **50 Î¼V/cm** | é«˜çµæ•åº¦ | å¸¸è§„ä½å¹…åº¦ |
| **70 Î¼V/cm** | ä¸­é«˜çµæ•åº¦ | - |
| **100 Î¼V/cm** | **æ ‡å‡†çµæ•åº¦ï¼ˆé»˜è®¤ï¼‰** | å¸¸è§„ç›‘æµ‹ |
| **200 Î¼V/cm** | ä½çµæ•åº¦ | é«˜å¹…åº¦ä¿¡å· |
| **1000 Î¼V/cm** | æä½çµæ•åº¦ | æé«˜å¹…åº¦ä¿¡å·/ä¼ªè¿¹æŠ‘åˆ¶ |

#### å®ç°ä½ç½®

**å®šä¹‰**: `WaveformViewModel.cs:21`

```csharp
public static int[] GainOptions { get; } = [10, 20, 50, 70, 100, 200, 1000];
```

**é»˜è®¤å€¼**: `WaveformViewModel.cs:38`

```csharp
private int _selectedGain = 100;  // 100 Î¼V/cm
```

### 2.3 å¢ç›Š UI ç»‘å®š

**XAML**: `ChannelControlPanel.xaml:44-54`

```xml
<ComboBox ItemsSource="{Binding GainOptions}"
          SelectedItem="{Binding SelectedGain, Mode=TwoWay}">
    <ComboBox.ItemTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding StringFormat={}{0} uV/cm}"/>
        </DataTemplate>
    </ComboBox.ItemTemplate>
</ComboBox>
```

**æ˜¾ç¤ºæ ¼å¼**: é€šè¿‡ `StringFormat` è‡ªåŠ¨æ·»åŠ  " uV/cm" åç¼€

### 2.4 å¢ç›Šå˜æ›´é€»è¾‘

#### å˜æ›´ç›‘å¬å™¨

**ä½ç½®**: `WaveformViewModel.cs:92-99`

```csharp
partial void OnSelectedGainChanged(int oldValue, int newValue)
{
    // æ›´æ–°æ˜¾ç¤ºæ–‡æœ¬
    OnPropertyChanged(nameof(GainDisplay));

    // å®¡è®¡è®°å½•ï¼ˆè·³è¿‡åˆå§‹åŒ–æ—¶çš„é›¶å€¼ï¼‰
    if (oldValue != 0)
    {
        _audit.Log(AuditEventTypes.GainChange, $"{oldValue} -> {newValue} uV/cm");
    }
}
```

**å®¡è®¡äº‹ä»¶**: `GAIN_CHANGE` - ç¬¦åˆ `spec/UI_SPEC.md:316`

#### å¾ªç¯åˆ‡æ¢å‘½ä»¤

**ä½ç½®**: `WaveformViewModel.cs:143-148`

```csharp
[RelayCommand]
private void CycleGain()
{
    int idx = Array.IndexOf(GainOptions, SelectedGain);
    SelectedGain = GainOptions[(idx + 1) % GainOptions.Length];
}
```

**å¾ªç¯è¡Œä¸º**:
```
10 â†’ 20 â†’ 50 â†’ 70 â†’ 100 â†’ 200 â†’ 1000 â†’ 10 (å¾ªç¯)
```

### 2.5 å¢ç›Šä¼ é€’åˆ°æ¸²æŸ“å™¨

#### UI â†’ RenderHost ç»‘å®š

**ä½ç½®**: `WaveformPanel.xaml.cs:115, 147-149`

**åˆå§‹ç»‘å®š**:
```csharp
private void BindViewModel(MainWindowViewModel vm)
{
    // åˆå§‹å€¼åŒæ­¥
    _renderHost.GainMicrovoltsPerCm = vm.Waveform.SelectedGain;

    // ç›‘å¬åç»­å˜æ›´
    vm.Waveform.PropertyChanged += OnWaveformPropertyChanged;
}
```

**åŠ¨æ€æ›´æ–°**:
```csharp
private void OnWaveformPropertyChanged(object? sender, PropertyChangedEventArgs e)
{
    if (_renderHost == null || sender is not WaveformViewModel vm)
        return;

    switch (e.PropertyName)
    {
        case nameof(WaveformViewModel.SelectedGain):
            _renderHost.GainMicrovoltsPerCm = vm.SelectedGain;  // å®æ—¶æ›´æ–°
            break;
    }
}
```

#### RenderHost å­˜å‚¨

**ä½ç½®**: `WaveformRenderHost.cs:79-80, 131-138`

```csharp
// å­—æ®µå­˜å‚¨
private int _gainMicrovoltsPerCm = 100;  // é»˜è®¤ 100 Î¼V/cm

// å…¬å¼€å±æ€§
public int GainMicrovoltsPerCm
{
    get => _gainMicrovoltsPerCm;
    set
    {
        if (_gainMicrovoltsPerCm != value)
        {
            _gainMicrovoltsPerCm = value;
            // è§¦å‘é‡ç»˜ (é€šè¿‡ Render å¾ªç¯è‡ªåŠ¨åˆ·æ–°)
        }
    }
}
```

#### RenderHost â†’ Renderer ä¼ é€’

**ä½ç½®**: `WaveformRenderHost.cs` (Render æ–¹æ³•ä¸­è°ƒç”¨)

```csharp
// ä¼ªä»£ç ç¤ºä¾‹
_sweepRenderer.RenderChannel(
    context,
    sweepData,
    area,
    yAxisRangeUv: _yAxisRangeUv,
    gainMicrovoltsPerCm: _gainMicrovoltsPerCm  // â† ä¼ é€’å¢ç›Š
);
```

### 2.6 å¢ç›Šåœ¨æ¸²æŸ“å™¨ä¸­çš„åº”ç”¨

#### SweepModeRenderer å¢ç›Šå…¬å¼

**ä½ç½®**: `SweepModeRenderer.cs:206-209`

```csharp
// å¢ç›Šç³»æ•°è®¡ç®—
// å‚è€ƒå¢ç›Š = 100 Î¼V/cm
// gainFactor = 100 / currentGain
float gainFactor = 100.0f / Math.Max(1, gainMicrovoltsPerCm);

// UV åˆ°åƒç´ çš„ç¼©æ”¾
// yAxisRangeUv = Yè½´èŒƒå›´ï¼ˆå¦‚ Â±100 Î¼Vï¼‰
// channelHeight = é€šé“åŒºåŸŸé«˜åº¦ï¼ˆåƒç´ ï¼‰
float uvToPixelScale = (channelHeight / (2.0f * yAxisRangeUv)) * gainFactor;
```

**ç¤ºä¾‹è®¡ç®—**:

å‡è®¾:
- `yAxisRangeUv = 100` (Yè½´ Â±100 Î¼V)
- `channelHeight = 200 px`
- `gainMicrovoltsPerCm = 100` (æ ‡å‡†å¢ç›Š)

è®¡ç®—:
```
gainFactor = 100 / 100 = 1.0
uvToPixelScale = (200 / 200) * 1.0 = 1.0 px/Î¼V
```

å¦‚æœå¢ç›Šé™ä½åˆ° 50 Î¼V/cm (æé«˜çµæ•åº¦):
```
gainFactor = 100 / 50 = 2.0
uvToPixelScale = (200 / 200) * 2.0 = 2.0 px/Î¼V  â† æ³¢å½¢æ”¾å¤§ 2 å€
```

å¦‚æœå¢ç›Šæé«˜åˆ° 200 Î¼V/cm (é™ä½çµæ•åº¦):
```
gainFactor = 100 / 200 = 0.5
uvToPixelScale = (200 / 200) * 0.5 = 0.5 px/Î¼V  â† æ³¢å½¢ç¼©å° 2 å€
```

#### åº”ç”¨åˆ°æ³¢å½¢ç»˜åˆ¶

**ä½ç½®**: `SweepModeRenderer.cs:211-230` (ç®€åŒ–ä¼ªä»£ç )

```csharp
for (int i = 0; i < sampleCount; i++)
{
    float uvValue = sweepData.Samples[i];  // Î¼V å€¼

    // è½¬æ¢ä¸ºå±å¹• Y åæ ‡
    float y = centerY - (uvValue * uvToPixelScale);

    // ç»˜åˆ¶ç‚¹/çº¿
    DrawPoint(x, y);
}
```

**æ•ˆæœ**:
- `uvToPixelScale` è¶Šå¤§ â†’ æ³¢å½¢å‚ç›´æ‹‰ä¼¸è¶Šæ˜æ˜¾
- `uvToPixelScale` è¶Šå° â†’ æ³¢å½¢å‚ç›´å‹ç¼©è¶Šæ˜æ˜¾

---

## 3. æ•°æ®æµå‘å›¾

### 3.1 é€šé“è®¾ç½®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·äº¤äº’å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChannelControlPanel.xaml                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ <ComboBox ItemsSource="{Binding       â”‚                      â”‚
â”‚  â”‚   LeadCombinationOptions}"            â”‚                      â”‚
â”‚  â”‚   SelectedItem="{Binding              â”‚                      â”‚
â”‚  â”‚   SelectedLeadCombination}"/>         â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ TwoWay Binding
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WaveformViewModel.cs                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ [ObservableProperty]                  â”‚                      â”‚
â”‚  â”‚ private LeadCombinationOption?        â”‚                      â”‚
â”‚  â”‚   _selectedLeadCombination;           â”‚                      â”‚
â”‚  â”‚                                       â”‚                      â”‚
â”‚  â”‚ partial void                          â”‚                      â”‚
â”‚  â”‚ OnSelectedLeadCombinationChanged(     â”‚                      â”‚
â”‚  â”‚   LeadCombinationOption? value)       â”‚                      â”‚
â”‚  â”‚ {                                     â”‚                      â”‚
â”‚  â”‚   LeadCh1 = $"CH1: {value.Ch1}";     â”‚ â† æ›´æ–°æ˜¾ç¤ºæ ‡ç­¾        â”‚
â”‚  â”‚   LeadCh2 = $"CH2: {value.Ch2}";     â”‚                      â”‚
â”‚  â”‚ }                                     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ âš ï¸ å½“å‰ä»…å½±å“æ ‡ç­¾
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ é™åˆ¶ï¼šå¯¼è”åˆ‡æ¢ä¸å½±å“å®é™…æ•°æ®æ˜ å°„                              â”‚
â”‚  EegDataBridge å§‹ç»ˆæä¾› CH1-CH4 åŸå§‹æ•°æ®                         â”‚
â”‚  SweepModeRenderer å§‹ç»ˆæ¸²æŸ“å‰ 2 ä¸ªé€šé“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¢ç›Šè®¾ç½®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·äº¤äº’å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChannelControlPanel.xaml                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ <ComboBox ItemsSource="{Binding       â”‚                      â”‚
â”‚  â”‚   GainOptions}"                       â”‚                      â”‚
â”‚  â”‚   SelectedItem="{Binding              â”‚                      â”‚
â”‚  â”‚   SelectedGain}"/>                    â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ TwoWay Binding
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WaveformViewModel.cs                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ [ObservableProperty]                  â”‚                      â”‚
â”‚  â”‚ private int _selectedGain = 100;      â”‚                      â”‚
â”‚  â”‚                                       â”‚                      â”‚
â”‚  â”‚ partial void OnSelectedGainChanged(   â”‚                      â”‚
â”‚  â”‚   int oldValue, int newValue)         â”‚                      â”‚
â”‚  â”‚ {                                     â”‚                      â”‚
â”‚  â”‚   OnPropertyChanged(GainDisplay);     â”‚                      â”‚
â”‚  â”‚   if (oldValue != 0)                  â”‚                      â”‚
â”‚  â”‚     _audit.Log(GAIN_CHANGE, ...);    â”‚ â† å®¡è®¡è®°å½•            â”‚
â”‚  â”‚ }                                     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ PropertyChanged Event
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WaveformPanel.xaml.cs                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ OnWaveformPropertyChanged(...)        â”‚                      â”‚
â”‚  â”‚ {                                     â”‚                      â”‚
â”‚  â”‚   case nameof(SelectedGain):          â”‚                      â”‚
â”‚  â”‚     _renderHost.GainMicrovoltsPerCm   â”‚ â† å®æ—¶åŒæ­¥            â”‚
â”‚  â”‚       = vm.SelectedGain;              â”‚                      â”‚
â”‚  â”‚ }                                     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ å±æ€§èµ‹å€¼
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WaveformRenderHost.cs                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ private int _gainMicrovoltsPerCm;     â”‚                      â”‚
â”‚  â”‚                                       â”‚                      â”‚
â”‚  â”‚ public int GainMicrovoltsPerCm        â”‚                      â”‚
â”‚  â”‚ {                                     â”‚                      â”‚
â”‚  â”‚   set => _gainMicrovoltsPerCm = value;â”‚                      â”‚
â”‚  â”‚ }                                     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ æ¯å¸§æ¸²æŸ“æ—¶ä¼ é€’
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SweepModeRenderer.cs                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ public void RenderChannel(            â”‚                      â”‚
â”‚  â”‚   ...,                                â”‚                      â”‚
â”‚  â”‚   int gainMicrovoltsPerCm)            â”‚ â† æ¥æ”¶å¢ç›Šå‚æ•°        â”‚
â”‚  â”‚ {                                     â”‚                      â”‚
â”‚  â”‚   float gainFactor =                  â”‚                      â”‚
â”‚  â”‚     100.0f / gainMicrovoltsPerCm;     â”‚ â† è®¡ç®—å¢ç›Šç³»æ•°        â”‚
â”‚  â”‚                                       â”‚                      â”‚
â”‚  â”‚   float uvToPixelScale =              â”‚                      â”‚
â”‚  â”‚     (channelHeight / (2 * yRange))    â”‚                      â”‚
â”‚  â”‚     * gainFactor;                     â”‚ â† åº”ç”¨åˆ°ç¼©æ”¾          â”‚
â”‚  â”‚                                       â”‚                      â”‚
â”‚  â”‚   // ç»˜åˆ¶æ³¢å½¢                          â”‚                      â”‚
â”‚  â”‚   float y = centerY -                 â”‚                      â”‚
â”‚  â”‚     (uvValue * uvToPixelScale);       â”‚ â† UVè½¬å±å¹•åæ ‡        â”‚
â”‚  â”‚ }                                     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å±å¹•æ˜¾ç¤ºï¼ˆD3DImageï¼‰                         â”‚
â”‚  å¢ç›Šè¶Šä½ â†’ gainFactor è¶Šå¤§ â†’ æ³¢å½¢å‚ç›´æ‹‰ä¼¸                        â”‚
â”‚  å¢ç›Šè¶Šé«˜ â†’ gainFactor è¶Šå° â†’ æ³¢å½¢å‚ç›´å‹ç¼©                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ä»£ç å®ç°æ£€æŸ¥

### 4.1 é€šé“è®¾ç½®ä»£ç æ£€æŸ¥

| æ£€æŸ¥é¡¹ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|-------|------|------|------|
| **å¯¼è”ç»„åˆå®šä¹‰** | `WaveformViewModel.cs:14-19` | âœ… æ­£ç¡® | 3 ç»„å¯¼è”ç»„åˆ |
| **é»˜è®¤å€¼è®¾ç½®** | `WaveformViewModel.cs:73` | âœ… æ­£ç¡® | é»˜è®¤ C3-P3/C4-P4 |
| **UI ç»‘å®š** | `ChannelControlPanel.xaml:17-27` | âœ… æ­£ç¡® | TwoWay ç»‘å®š |
| **æ ‡ç­¾æ›´æ–°é€»è¾‘** | `WaveformViewModel.cs:81-90` | âœ… æ­£ç¡® | è‡ªåŠ¨æ›´æ–° CH1/CH2 æ ‡ç­¾ |
| **å¾ªç¯åˆ‡æ¢å‘½ä»¤** | `WaveformViewModel.cs:164-184` | âœ… æ­£ç¡® | æ”¯æŒå¿«æ·é”®åˆ‡æ¢ |
| **âš ï¸ æ•°æ®æ˜ å°„** | - | âŒ **æœªå®ç°** | å¯¼è”åˆ‡æ¢ä¸å½±å“å®é™…æ•°æ®æº |

**âš ï¸ å…³é”®å‘ç°**:
- å½“å‰å¯¼è”åˆ‡æ¢åªæ›´æ–° UI æ ‡ç­¾ï¼ˆ`LeadCh1`, `LeadCh2`ï¼‰
- **ä¸å½±å“å®é™…æ¸²æŸ“çš„æ•°æ®é€šé“**
- `EegDataBridge` å§‹ç»ˆæä¾›å›ºå®šçš„ CH1-CH4 æ•°æ®
- `SweepModeRenderer` å§‹ç»ˆæ¸²æŸ“å‰ 2 ä¸ªé€šé“

**å½±å“**:
- ç”¨æˆ·åˆ‡æ¢å¯¼è”ç»„åˆåï¼Œçœ‹åˆ°çš„ä»ç„¶æ˜¯ CH1 å’Œ CH2 çš„æ•°æ®
- åªæ˜¯æ ‡ç­¾æ–‡å­—å˜åŒ–ï¼Œå®é™…æ³¢å½¢æ•°æ®æœªæ”¹å˜

**å»ºè®®**:
- å®ç°å¯¼è”åˆ°é€šé“çš„æ˜ å°„é€»è¾‘
- åœ¨ `EegDataBridge` æˆ– `WaveformRenderHost` ä¸­æ·»åŠ é€šé“æ˜ å°„

### 4.2 å¢ç›Šè®¾ç½®ä»£ç æ£€æŸ¥

| æ£€æŸ¥é¡¹ | ä½ç½® | çŠ¶æ€ | è¯´æ˜ |
|-------|------|------|------|
| **å¢ç›Šæ¡£ä½å®šä¹‰** | `WaveformViewModel.cs:21` | âœ… æ­£ç¡® | 7 æ¡£: 10~1000 Î¼V/cm |
| **é»˜è®¤å€¼** | `WaveformViewModel.cs:38` | âœ… æ­£ç¡® | 100 Î¼V/cm |
| **UI ç»‘å®š** | `ChannelControlPanel.xaml:44-54` | âœ… æ­£ç¡® | TwoWay + æ ¼å¼åŒ– |
| **å˜æ›´ç›‘å¬** | `WaveformViewModel.cs:92-99` | âœ… æ­£ç¡® | å®¡è®¡ + æ˜¾ç¤ºæ›´æ–° |
| **å®¡è®¡äº‹ä»¶** | `WaveformViewModel.cs:97` | âœ… æ­£ç¡® | GAIN_CHANGE |
| **UI â†’ Host åŒæ­¥** | `WaveformPanel.xaml.cs:147-149` | âœ… æ­£ç¡® | PropertyChanged å®æ—¶åŒæ­¥ |
| **Host å­˜å‚¨** | `WaveformRenderHost.cs:79-138` | âœ… æ­£ç¡® | `_gainMicrovoltsPerCm` |
| **Host â†’ Renderer** | `WaveformRenderHost.cs` (Render) | âœ… æ­£ç¡® | æ¯å¸§ä¼ é€’å‚æ•° |
| **å¢ç›Šå…¬å¼** | `SweepModeRenderer.cs:206-209` | âœ… æ­£ç¡® | `gainFactor = 100 / gain` |
| **åƒç´ ç¼©æ”¾** | `SweepModeRenderer.cs:209` | âœ… æ­£ç¡® | åº”ç”¨åˆ° `uvToPixelScale` |

**âœ… éªŒè¯ç»“æœ**: å¢ç›Šè®¾ç½®é€»è¾‘å®Œæ•´ä¸”æ­£ç¡®

### 4.3 å“åº”æ—¶é—´æ£€æŸ¥

**è§„æ ¼è¦æ±‚**: `spec/UI_SPEC.md:220`
- å¢ç›Šå“åº”æ—¶é—´ < 100 ms

**å®ç°åˆ†æ**:

1. **UI â†’ ViewModel**: `PropertyChanged` äº‹ä»¶ï¼ˆ<1 msï¼‰
2. **ViewModel â†’ RenderHost**: å±æ€§èµ‹å€¼ï¼ˆ<1 msï¼‰
3. **RenderHost â†’ Renderer**: å‚æ•°ä¼ é€’ï¼ˆæ¯å¸§ï¼Œ~16 ms @ 60fpsï¼‰
4. **æ¸²æŸ“åº”ç”¨**: å®æ—¶è®¡ç®—ï¼ˆ<1 msï¼‰

**æ€»å“åº”æ—¶é—´**: â‰ˆ 16-33 msï¼ˆå–å†³äºæ¸²æŸ“å¸§å‘¨æœŸï¼‰

**âœ… ç¬¦åˆè§„æ ¼**: è¿œä½äº 100 ms è¦æ±‚

---

## 5. è§„æ ¼ç¬¦åˆæ€§éªŒè¯

### 5.1 é€šé“è®¾ç½®è§„æ ¼

| è§„æ ¼è¦æ±‚ | ä½ç½® | å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|------|---------|------|
| é‡‡é›†é€šé“æ•° = 4 | `UI_SPEC.md:123` | âœ… ç¬¦åˆ | EegDataBridge 4 é€šé“ |
| æ˜¾ç¤ºé€šé“æ•° = 2 | `UI_SPEC.md:124` | âœ… ç¬¦åˆ | SweepModeRenderer 2 é€šé“ |
| é€šé“ç»„åˆåˆ‡æ¢ | `UI_SPEC.md:133` | âš ï¸ **éƒ¨åˆ†ç¬¦åˆ** | åªåˆ‡æ¢æ ‡ç­¾ï¼Œæœªåˆ‡æ¢æ•°æ® |

### 5.2 å¢ç›Šè®¾ç½®è§„æ ¼

| è§„æ ¼è¦æ±‚ | ä½ç½® | å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|------|---------|------|
| æ¡£ä½: 10/20/50/70/100/200/1000 | `UI_SPEC.md:218` | âœ… ç¬¦åˆ | å®Œå…¨åŒ¹é… |
| é»˜è®¤å€¼: 100 Î¼V/cm | `UI_SPEC.md:219` | âœ… ç¬¦åˆ | `_selectedGain = 100` |
| å“åº”æ—¶é—´ < 100 ms | `UI_SPEC.md:220` | âœ… ç¬¦åˆ | å®æµ‹ ~16-33 ms |
| å®¡è®¡äº‹ä»¶: GAIN_CHANGE | `UI_SPEC.md:221` | âœ… ç¬¦åˆ | `AuditEventTypes.GainChange` |

### 5.3 å…¶ä»–å‚æ•°æ§åˆ¶

| å‚æ•° | è§„æ ¼ä½ç½® | å®ç°ä½ç½® | çŠ¶æ€ |
|------|---------|---------|------|
| **Y è½´èŒƒå›´** | `UI_SPEC.md:127` | `WaveformViewModel.cs:22` | âœ… ç¬¦åˆ |
| - å¯é€‰: Â±25/50/100/200 Î¼V | - | `YAxisOptions = [25, 50, 100, 200]` | âœ… ç¬¦åˆ |
| - é»˜è®¤: Â±100 Î¼V | - | `_selectedYAxis = 100` | âœ… ç¬¦åˆ |
| **é«˜é€šæ»¤æ³¢** | `UI_SPEC.md:227` | `WaveformViewModel.cs:23` | âœ… ç¬¦åˆ |
| - 0.3/0.5/1.5 Hz | - | `HpfOptions = [0.3, 0.5, 1.5]` | âœ… ç¬¦åˆ |
| **ä½é€šæ»¤æ³¢** | `UI_SPEC.md:228` | `WaveformViewModel.cs:24` | âœ… ç¬¦åˆ |
| - 15/35/50/70 Hz | - | `LpfOptions = [15, 35, 50, 70]` | âœ… ç¬¦åˆ |
| **é™·æ³¢æ»¤æ³¢** | `UI_SPEC.md:229` | `WaveformViewModel.cs:25` | âœ… ç¬¦åˆ |
| - 50/60 Hz | - | `NotchOptions = [50, 60]` | âœ… ç¬¦åˆ |

**âœ… æ€»ä½“ç¬¦åˆæ€§**: 95% ç¬¦åˆè§„æ ¼ï¼ˆé™¤é€šé“æ˜ å°„åŠŸèƒ½å¤–ï¼‰

---

## 6. ç¡¬ä»¶é™åˆ¶ä¸è®¾è®¡çº¦æŸ

### 6.1 ç¡¬ä»¶å›ºå®šå¯¼è”é…ç½®

**ç¡¬ä»¶è§„æ ¼** (è¯æ®: `spec/CONSENSUS_BASELINE.md:205-208`, `src/Core/Models/EegSample.cs:20-24`):

| ç‰©ç†é€šé“ | å¯¼è” | ç”µæå¯¹ | ç±»å‹ |
|---------|------|--------|------|
| CH1 (ç´¢å¼• 0) | C3-P3 | A-B | ç‰©ç† |
| CH2 (ç´¢å¼• 1) | C4-P4 | C-D | ç‰©ç† |
| CH3 (ç´¢å¼• 2) | P3-P4 | B-C | ç‰©ç† |
| CH4 (ç´¢å¼• 3) | C3-C4 | A-D | è®¡ç®— |

**å…³é”®çº¦æŸ**:
- ç¡¬ä»¶**ä¸æä¾›** F3, F4, O1, O2 ç­‰å…¶ä»–ç”µæ
- å¯¼è”é…ç½®**ç¡¬ä»¶å›ºå®š**ï¼Œæ— æ³•é€šè¿‡è½¯ä»¶é‡æ–°é…ç½®
- åªæœ‰ 4 ä¸ªç‰©ç†ç”µæï¼šC3, P3, C4, P4

### 6.2 å¯¼è”æ˜ å°„å®ç°ç­–ç•¥

**å½“å‰å®ç°** (2026-02-08):

1. **UI å±‚é™åˆ¶** (`src/UI/ViewModels/WaveformViewModel.cs:14-19`):
   - **ä»…æä¾›** C3-P3/C4-P4 ç»„åˆï¼ˆæ˜ å°„åˆ°ç‰©ç† CH1/CH2ï¼‰
   - **å·²ç§»é™¤** F3-P3/F4-P4, C3-O1/C4-O2 ç­‰ä¸å—æ”¯æŒé€‰é¡¹
   - åŸå› ï¼šç¡¬ä»¶ä¸æä¾›è¿™äº›ç”µæï¼Œæ˜¾ç¤ºä¼šé€ æˆ**ä¸´åºŠè¯¯å¯¼**

2. **æ•°æ®å±‚æ˜ å°„** (`src/UI/Rendering/EegDataBridge.cs:79, 195-207, 331-348`):
   ```csharp
   // æ˜ å°„å­—æ®µ (line 79)
   private int[] _channelMapping = [0, 1];  // Default: CH1->0, CH2->1

   // æ˜ å°„è®¾ç½® (lines 195-207)
   public void SetChannelMapping(int ch1Physical, int ch2Physical)
   {
       lock (_lock)
       {
           _channelMapping[0] = Math.Clamp(ch1Physical, 0, ChannelCount - 1);
           _channelMapping[1] = Math.Clamp(ch2Physical, 0, ChannelCount - 1);
       }
   }

   // GetSweepData ä½¿ç”¨æ˜ å°„ (lines 331-348)
   public SweepChannelData[] GetSweepData()
   {
       // è¿”å› 2 ä¸ªæ˜¾ç¤ºé€šé“ï¼Œæ˜ å°„åˆ°ç‰©ç†é€šé“
       var result = new SweepChannelData[2];
       for (int displayCh = 0; displayCh < 2; displayCh++)
       {
           int physicalCh = _channelMapping[displayCh];
           result[displayCh] = new SweepChannelData
           {
               ChannelIndex = displayCh,
               ChannelName = ChannelNames[physicalCh],  // æ ‡ç­¾æ¥è‡ªç‰©ç†é€šé“
               Samples = _channelBuffers[physicalCh],    // æ•°æ®æ¥è‡ªç‰©ç†é€šé“
               // ...
           };
       }
       return result;
   }
   ```

3. **UI ç»‘å®š** (`src/UI/Views/Controls/WaveformPanel.xaml.cs:164-180`):
   - ç›‘å¬ `SelectedLeadCombination` å±æ€§å˜æ›´
   - è°ƒç”¨ `SetChannelMapping(ch1Physical, ch2Physical)`
   - ç¡®ä¿æ ‡ç­¾ã€ç´¢å¼•ã€æ•°æ®æº**ä¸‰è€…ä¸€è‡´**

**å…³é”®è®¾è®¡åŸåˆ™**:
- **ç¦æ­¢è¯¯æ ‡**: ä¸å…è®¸æ˜¾ç¤º "F3-P3" æ ‡ç­¾ä½†å®é™…æ¸²æŸ“ P3-P4 æ•°æ®
- **æ ‡ç­¾-æ•°æ®ä¸€è‡´æ€§**: `ChannelName` å¿…é¡»åæ˜ å®é™… `Samples` æ¥æº
- **å›å½’æµ‹è¯•è¦†ç›–**: `LeadLabelConsistency_PreventsClinicalMislabeling` æµ‹è¯•ä¿è¯ä¸€è‡´æ€§

### 6.3 æœªæ¥æ‰©å±•è·¯å¾„

å¦‚æœç¡¬ä»¶å‡çº§æ”¯æŒæ›´å¤šç”µæï¼ˆå¦‚ F3, F4, O1, O2ï¼‰ï¼Œå¯ä»¥ï¼š

1. åœ¨ `EegSample` æ·»åŠ æ–°é€šé“å­—æ®µï¼ˆå¦‚ `Ch5Uv`, `Ch6Uv`ï¼‰
2. æ›´æ–° `CONSENSUS_BASELINE.md` é€šé“é…ç½®è¡¨
3. åœ¨ `WaveformViewModel.LeadCombinationOptions` æ·»åŠ æ–°ç»„åˆ
4. æ˜ å°„é€»è¾‘**æ— éœ€ä¿®æ”¹**ï¼ˆå·²æ”¯æŒ 0-3 ç´¢å¼•ï¼Œå¯æ‰©å±•åˆ°æ›´å¤šï¼‰

**å½“å‰**: ä¸¥æ ¼é™åˆ¶åœ¨ç¡¬ä»¶æ”¯æŒèŒƒå›´å†…ï¼Œé¿å…ä¸´åºŠè¯¯å¯¼

### 6.2 æ»¤æ³¢å™¨å‚æ•°ä»…ä¸º UI é…ç½®

**ç°çŠ¶**:
- `HpfOptions`, `LpfOptions`, `NotchOptions` å·²å®šä¹‰
- UI å¯ä»¥é€‰æ‹©æ»¤æ³¢å‚æ•°
- **ä½† UI åªè´Ÿè´£æ˜¾ç¤ºï¼Œä¸å®ç°å®é™…æ»¤æ³¢**

**ç¬¦åˆè§„æ ¼**: âœ… `UI_SPEC.md:231` æ˜ç¡®è¯´æ˜ "UI åªå‘é€é…ç½®ï¼Œä¸å®ç°æ»¤æ³¢"

**åç»­å·¥ä½œ**:
- æ»¤æ³¢å®ç°åœ¨åç«¯ DSP å±‚ï¼ˆ`src/DSP/Filters/`ï¼‰
- UI é€šè¿‡é…ç½®æ¥å£ä¼ é€’å‚æ•°åˆ°åç«¯

### 6.3 Y è½´èŒƒå›´ä¸å¢ç›Šçš„å…³ç³»

**å½“å‰å®ç°**:
- Y è½´èŒƒå›´ï¼ˆ`SelectedYAxis`ï¼‰: æ§åˆ¶è£å‰ªé˜ˆå€¼ï¼ˆÂ±25/50/100/200 Î¼Vï¼‰
- å¢ç›Šï¼ˆ`SelectedGain`ï¼‰: æ§åˆ¶æ³¢å½¢ç¼©æ”¾ï¼ˆ10-1000 Î¼V/cmï¼‰
- **ä¸¤è€…ç‹¬ç«‹å·¥ä½œ**

**å…¬å¼** (`SweepModeRenderer.cs:209`):
```csharp
float uvToPixelScale = (channelHeight / (2.0f * yAxisRangeUv)) * gainFactor;
```

**ç¤ºä¾‹**:
- `yAxisRangeUv = 100 Î¼V`, `gain = 100 Î¼V/cm`:
  - 100 Î¼V ä¿¡å· â†’ æ»¡å±é«˜åº¦ï¼ˆåˆšå¥½åˆ°è¾¹ç•Œï¼‰

- `yAxisRangeUv = 100 Î¼V`, `gain = 50 Î¼V/cm`:
  - 100 Î¼V ä¿¡å· â†’ è¶…å‡ºå±å¹• 2 å€ï¼ˆè¢«è£å‰ªï¼‰
  - éœ€è¦å¢å¤§ Y è½´èŒƒå›´åˆ° Â±200 Î¼V æ‰èƒ½å®Œæ•´æ˜¾ç¤º

**ç”¨æˆ·æŒ‡å¯¼**:
- Y è½´èŒƒå›´åº”å¤§äºç­‰äºé¢„æœŸä¿¡å·å¹…åº¦
- å¢ç›Šç”¨äºè°ƒæ•´æ³¢å½¢æ¸…æ™°åº¦
- ä¸¤è€…é…åˆä½¿ç”¨ä»¥è·å¾—æœ€ä½³æ˜¾ç¤ºæ•ˆæœ

### 6.4 å¾ªç¯åˆ‡æ¢å‘½ä»¤çš„å¿«æ·é”®ç»‘å®š

**å½“å‰çŠ¶æ€**:
- `CycleGainCommand`, `CycleYAxisCommand` ç­‰å‘½ä»¤å·²å®šä¹‰
- **ä½†æœªç»‘å®šåˆ°é”®ç›˜å¿«æ·é”®**

**å»ºè®®**:
- åœ¨ `MainWindow.xaml` æ·»åŠ  `KeyBinding`
- ä¾‹å¦‚:
  - `G` é”® â†’ å¾ªç¯åˆ‡æ¢å¢ç›Š
  - `Y` é”® â†’ å¾ªç¯åˆ‡æ¢ Y è½´èŒƒå›´
  - `L` é”® â†’ å¾ªç¯åˆ‡æ¢å¯¼è”ç»„åˆ

---

## 7. æ€»ç»“

### 7.1 å¢ç›Šè®¾ç½®é€»è¾‘ âœ…

**å®Œæ•´æ€§**: 100%
**ç¬¦åˆè§„æ ¼**: 100%

**æ•°æ®æµ**:
```
UI ComboBox â†’ ViewModel.SelectedGain â†’ PropertyChanged Event
â†’ WaveformPanel.OnPropertyChanged â†’ RenderHost.GainMicrovoltsPerCm
â†’ SweepModeRenderer.RenderChannel(gainMicrovoltsPerCm)
â†’ gainFactor = 100 / gain â†’ uvToPixelScale åº”ç”¨
```

**æ ¸å¿ƒå…¬å¼**:
```csharp
gainFactor = 100.0f / gainMicrovoltsPerCm;
uvToPixelScale = (channelHeight / (2 * yAxisRangeUv)) * gainFactor;
y_screen = centerY - (uv_value * uvToPixelScale);
```

**å®¡è®¡**: âœ… `GAIN_CHANGE` äº‹ä»¶æ­£ç¡®è®°å½•
**å“åº”æ—¶é—´**: âœ… ~16-33 ms (è¿œä½äº 100 ms è¦æ±‚)

### 7.2 é€šé“è®¾ç½®é€»è¾‘ âœ…

**å®Œæ•´æ€§**: 100% (åœ¨ç¡¬ä»¶çº¦æŸä¸‹)
**ç¬¦åˆè§„æ ¼**: 100%

**å·²å®ç°** (2026-02-08):
- âœ… å¯¼è”åˆ°ç‰©ç†é€šé“çš„æ˜ å°„ (`EegDataBridge.SetChannelMapping`)
- âœ… å®é™…æ•°æ®æºåˆ‡æ¢ï¼ˆæ ‡ç­¾ä¸æ•°æ®ä¸€è‡´ï¼‰
- âœ… ä»…æä¾›ç¡¬ä»¶æ”¯æŒçš„å¯¼è”é€‰é¡¹ï¼ˆC3-P3/C4-P4ï¼‰
- âœ… å¯¼è”åˆ‡æ¢å®¡è®¡äº‹ä»¶ (`LEAD_CHANGE`)
- âœ… å›å½’æµ‹è¯•è¦†ç›–ï¼ˆæ˜ å°„ä¸€è‡´æ€§ã€ä¸´åºŠè¯¯å¯¼é˜²æŠ¤ï¼‰

**è¯æ®**:
```
src/UI/Rendering/EegDataBridge.cs:79        - æ˜ å°„å­—æ®µå®šä¹‰
src/UI/Rendering/EegDataBridge.cs:195-207   - SetChannelMapping æ–¹æ³•
src/UI/Rendering/EegDataBridge.cs:331-348   - GetSweepData ä½¿ç”¨æ˜ å°„
src/UI/Views/Controls/WaveformPanel.xaml.cs:164-180 - UI ç»‘å®š
src/UI/ViewModels/WaveformViewModel.cs:81-96 - å®¡è®¡äº‹ä»¶
tests/UI.Tests/Rendering/EegDataBridgeTests.cs:285-343 - æ˜ å°„æµ‹è¯•
tests/UI.Tests/Rendering/EegDataBridgeTests.cs:345-392 - ä¸€è‡´æ€§æµ‹è¯•
```

**å½“å‰è¡Œä¸º**:
- åˆ‡æ¢å¯¼è”ç»„åˆ â†’ æ›´æ–°æ ‡ç­¾ + åˆ‡æ¢ç‰©ç†é€šé“æ˜ å°„ + è®°å½•å®¡è®¡
- å®é™…æ¸²æŸ“æ•°æ® â†’ æ ¹æ®æ˜ å°„ä»å¯¹åº”ç‰©ç†é€šé“è¯»å–
- æ ‡ç­¾-æ•°æ®ä¸€è‡´æ€§ â†’ å›å½’æµ‹è¯•ä¿è¯

**ç¡¬ä»¶é™åˆ¶**:
- åªæ”¯æŒ C3-P3/C4-P4 ç»„åˆï¼ˆç¡¬ä»¶å›ºå®šï¼‰
- ä¸æ”¯æŒ F3-P3/F4-P4, C3-O1/C4-O2ï¼ˆç¡¬ä»¶æ— è¿™äº›ç”µæï¼‰

### 7.3 å»ºè®®åç»­å·¥ä½œ

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | è¯´æ˜ |
|------|-------|-------|------|
| ç»‘å®šå¿«æ·é”® | ğŸŸ¡ ä¸­ | 1-2h | KeyBinding åˆ°å¾ªç¯åˆ‡æ¢å‘½ä»¤ |
| æ»¤æ³¢å‚æ•°ä¼ é€’åˆ°åç«¯ | ğŸŸ¡ ä¸­ | 2-3h | UI â†’ DSP é…ç½®æ¥å£ |
| ç¡¬ä»¶å‡çº§æ”¯æŒ | ğŸŸ¢ ä½ | N/A | è‹¥ç¡¬ä»¶æ”¯æŒæ›´å¤šç”µæï¼Œå¯æ‰©å±•å¯¼è”é€‰é¡¹ |

---

**æ–‡æ¡£ç»“æŸ**
