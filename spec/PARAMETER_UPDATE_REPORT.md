# ğŸ“‹ NEO aEEG + NIRS æ–¹æ¡ˆæ›´æ–°åˆ†ææŠ¥å‘Š

> **åŸºäºé¡¹ç›®å®é™…èµ„æ–™çš„åˆ†æ**  
> **ç”Ÿæˆæ—¥æœŸ**: 2025-01-21  
> **çŠ¶æ€**: éœ€è¦æŒ‡æŒ¥å®˜å®¡æ‰¹

---

## ä¸€ã€å…³é”®å‘ç°æ±‡æ€»

é€šè¿‡åˆ†æä¸Šä¼ çš„é¡¹ç›®èµ„æ–™ï¼ˆè½¯ä»¶è§„æ ¼æ–‡æ¡£ã€ç¤ºä¾‹ä»£ç ã€ç•Œé¢æˆªå›¾ï¼‰ï¼Œå‘ç°ä»¥ä¸‹**ä¸åŸæ–¹æ¡ˆä¸ä¸€è‡´**çš„é‡è¦å‚æ•°ï¼š

### ğŸ”´ å¿…é¡»ä¿®æ”¹é¡¹ï¼ˆP0ï¼‰

| å‚æ•° | åŸæ–¹æ¡ˆ | å®é™…è§„æ ¼ | å½±å“ |
|------|--------|----------|------|
| **EEGé‡‡æ ·ç‡** | 120 Hz | **160 Hz** | æ»¤æ³¢å™¨å‚æ•°ã€LODè®¡ç®—ã€æ•°æ®ç»“æ„ |
| **EEGé€šé“æ•°** | 2 è·¯ | **4 è·¯**ï¼ˆ3ç‰©ç†+1è®¡ç®—ï¼‰ | ç•Œé¢å¸ƒå±€ã€æ•°æ®å¤„ç† |
| **NIRSé€šé“æ•°** | 1 è·¯ | **6 è·¯**ï¼ˆ3ç»„æ˜¾ç¤ºï¼‰ | ç•Œé¢å¸ƒå±€ã€æ•°æ®ç»“æ„ |

### ğŸŸ¡ éœ€è¦è¡¥å……é¡¹ï¼ˆP1ï¼‰

| å‚æ•° | åŸæ–¹æ¡ˆ | å®é™…è§„æ ¼ | è¯´æ˜ |
|------|--------|----------|------|
| **é«˜é€šæ»¤æ³¢é€‰é¡¹** | 0.5 Hz | **0.3, 0.5, 1.5 Hz** | å¤šæ¡£ä½å¯é€‰ |
| **ä½é€šæ»¤æ³¢é€‰é¡¹** | 35 Hz | **15, 35, 50, 70 Hz** | å¤šæ¡£ä½å¯é€‰ |
| **Notch æ»¤æ³¢** | 50 Hz | **50 Hz / 60 Hz å¯é€‰** | æ”¯æŒå›½é™…æ ‡å‡† |
| **è§†é¢‘åŠŸèƒ½** | æœªæ˜ç¡® | **å®æ—¶è§†é¢‘+åŒæ­¥å›æ”¾** | éœ€è¦è§†é¢‘æ¨¡å— |
| **aEEGæ˜¾ç¤º** | çº¿æ€§Yè½´ | **å¯¹æ•°Yè½´**ï¼ˆ0-200Î¼Vï¼‰ | æ¸²æŸ“é€»è¾‘å˜åŒ– |

### ğŸŸ¢ å·²æ­£ç¡®å®šä¹‰é¡¹

| å‚æ•° | åŸæ–¹æ¡ˆ | å®é™…è§„æ ¼ | çŠ¶æ€ |
|------|--------|----------|------|
| aEEG å¸¦é€š | 2-15 Hz | 2-15 Hz | âœ… ä¸€è‡´ |
| aEEG ç®—æ³• | æ•´æµ+åŒ…ç»œ+å¹³æ»‘ | æ•´æµ+å¹³å‡+å¹³æ»‘ | âœ… åŸºæœ¬ä¸€è‡´ |
| 72h é•¿ç¨‹ç›‘æŠ¤ | æ”¯æŒ | æ”¯æŒ | âœ… ä¸€è‡´ |
| Min/Max åŒ…ç»œ | Zoom Out | Zoom Out | âœ… ä¸€è‡´ |

---

## äºŒã€è¯¦ç»†å‚æ•°æ›´æ–°

### 2.1 EEG æ•°æ®é‡‡é›†å‚æ•°

```yaml
# åŸæ–¹æ¡ˆ
EEG:
  sample_rate: 120 Hz
  channels: 2
  packet_rate: ~120 Hz

# æ›´æ–°å
EEG:
  sample_rate: 160 Hz              # â† ä¿®æ”¹
  channels: 4                       # â† ä¿®æ”¹
  channel_names: [CH1, CH2, CH3, CH4]  # CH4ä¸ºè®¡ç®—é€šé“
  packet_rate: 160 Hz              # ä¸é‡‡æ ·ç‡ä¸€è‡´
  data_format:
    raw_bits: 16
    scale_factor: 0.076            # Î¼V/LSB
  serial_baud: 115200
```

### 2.2 é€šé“é…ç½®ï¼ˆæ¥è‡ª MR æ–‡æ¡£ï¼‰

```yaml
channels:
  CH1: 
    name: "é€šé“1"
    montage: "C3-P3 (A-B)"
  CH2:
    name: "é€šé“2" 
    montage: "C4-P4 (C-D)"
  CH3:
    name: "é€šé“3"
    montage: "P3-P4 (B-C)"
  CH4:
    name: "é€šé“4"
    montage: "C3-C4 (A-D)"      # è®¡ç®—é€šé“
    type: "computed"
```

### 2.3 æ»¤æ³¢å™¨å‚æ•°æ›´æ–°

```yaml
# åŸæ–¹æ¡ˆ
filters:
  highpass: 0.5 Hz (Butterworth 2é˜¶)
  lowpass: 35 Hz (Butterworth 4é˜¶)
  notch: 50 Hz (Q=30)

# æ›´æ–°å - æ”¯æŒå¤šæ¡£ä½
filters:
  highpass:
    type: Butterworth IIR
    order: 2
    options: [0.3, 0.5, 1.5]      # Hzï¼Œå¯é€‰
    default: 0.5
  
  lowpass:
    type: Butterworth IIR
    order: 4
    options: [15, 35, 50, 70]     # Hzï¼Œå¯é€‰
    default: 35
  
  notch:
    type: IIR Notch
    order: 2
    options: [50, 60]             # Hzï¼Œå¯é€‰
    default: 50
    Q: 30
```

### 2.4 aEEG ç®—æ³•å‚æ•°

```yaml
aeeg:
  bandpass: 2-15 Hz (Butterworth 4é˜¶)
  rectification: half_wave  # |x|
  envelope:
    window: 0.5 sec
    method: max
  smoothing:
    window: 15 sec
    method: moving_average
  output:
    rate: 1 Hz              # æ¯ç§’è¾“å‡º min/max
    format: histogram       # GS ç›´æ–¹å›¾æ ¼å¼
    histogram_bins: 230     # 0-229
    histogram_interval: 15  # ç§’
```

### 2.5 NIRS å‚æ•°ï¼ˆæ–°å¢ï¼‰

```yaml
nirs:
  channels: 6                    # ç»„ç»‡æ°§é€šé“æ•°
  display_groups: 3              # æ˜¾ç¤ºåˆ†ç»„æ•°
  sample_rate: 1-4 Hz           # ä½é€Ÿé‡‡æ ·
  value_range: [0, 100]          # ç™¾åˆ†æ¯”
  display:
    danger_zone: [0, 50]         # çº¢è‰²åŒºåŸŸ
    warning_zone: [50, 65]       # é»„è‰²åŒºåŸŸ
    normal_zone: [65, 100]       # ç»¿è‰²åŒºåŸŸ
```

### 2.6 æ˜¾ç¤ºå‚æ•°

```yaml
display:
  aeeg:
    y_axis: logarithmic          # å¯¹æ•°åˆ»åº¦
    y_ticks: [0, 5, 10, 25, 50, 100, 200]
    time_range: 3 hours
    background_zones:            # å½©è‰²èƒŒæ™¯åŒºåŸŸ
      normal: [10, 25]           # Î¼Vï¼Œç»¿è‰²
      
  eeg:
    y_axis: linear
    y_range_options: [25, 50, 100, 200]  # Î¼V
    time_range_options: [7, 14, 20]       # ç§’
    default_time_range: 15 sec
    
  gain_options: [25, 50, 100, 200]  # Î¼V/cm
  sweep_speed: mm/sec
```

---

## ä¸‰ã€æ¶æ„å½±å“åˆ†æ

### 3.1 éœ€è¦ä¿®æ”¹çš„æ¨¡å—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¶æ„å˜æ›´å½±å“                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ”´ å¿…é¡»ä¿®æ”¹                                                    â”‚
â”‚  â”œâ”€â”€ æ•°æ®é‡‡é›†å±‚                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ é‡‡æ ·ç‡: 120 â†’ 160 Hz                                  â”‚
â”‚  â”‚   â””â”€â”€ é€šé“æ•°: 2 â†’ 4                                         â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ DSP å±‚                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ æ»¤æ³¢å™¨ç³»æ•°é‡æ–°è®¡ç®—ï¼ˆ160HzåŸºå‡†ï¼‰                        â”‚
â”‚  â”‚   â”œâ”€â”€ LODé‡‘å­—å¡”å±‚æ•°è°ƒæ•´                                      â”‚
â”‚  â”‚   â””â”€â”€ å¤šæ¡£ä½æ»¤æ³¢å™¨æ”¯æŒ                                       â”‚
â”‚  â”‚                                                             â”‚
â”‚  â””â”€â”€ æ¸²æŸ“å±‚                                                     â”‚
â”‚      â”œâ”€â”€ 4é€šé“ EEG å¸ƒå±€                                         â”‚
â”‚      â”œâ”€â”€ 6é€šé“ NIRS å¸ƒå±€                                        â”‚
â”‚      â”œâ”€â”€ aEEG å¯¹æ•°Yè½´æ¸²æŸ“                                       â”‚
â”‚      â””â”€â”€ è§†é¢‘çª—å£é›†æˆ                                           â”‚
â”‚                                                                 â”‚
â”‚  ğŸŸ¡ éœ€è¦è¡¥å……                                                    â”‚
â”‚  â”œâ”€â”€ è§†é¢‘æ¨¡å—ï¼ˆVideoManagerï¼‰                                   â”‚
â”‚  â”œâ”€â”€ æ»¤æ³¢å™¨å‚æ•° UI é€‰æ‹©                                         â”‚
â”‚  â””â”€â”€ GS ç›´æ–¹å›¾å¤„ç†                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¥å£å¥‘çº¦å˜æ›´

```csharp
// åŸæ¥å£
public interface ITimeSeriesSource
{
    int SampleRate { get; }  // åŸ: 120, æ–°: 160
    int ChannelCount { get; }  // åŸ: 2, æ–°: 4 (EEG) + 6 (NIRS)
    // ...
}

// éœ€è¦æ–°å¢
public interface IFilterSettings
{
    double HighpassCutoff { get; set; }   // 0.3, 0.5, 1.5
    double LowpassCutoff { get; set; }    // 15, 35, 50, 70
    int NotchFrequency { get; set; }      // 50, 60
}
```

---

## å››ã€DSP å‚æ•°é‡æ–°è®¡ç®—

### 4.1 Butterworth æ»¤æ³¢å™¨ç³»æ•°ï¼ˆ160Hz é‡‡æ ·ç‡ï¼‰

```python
# é«˜é€š 0.5Hz @ 160Hz
HP_0.5Hz:
  normalized_freq: 0.5 / 80 = 0.00625
  order: 2
  # ç³»æ•°éœ€è¦é‡æ–°è®¡ç®—

# ä½é€š 35Hz @ 160Hz  
LP_35Hz:
  normalized_freq: 35 / 80 = 0.4375
  order: 4
  # ç³»æ•°éœ€è¦é‡æ–°è®¡ç®—

# Notch 50Hz @ 160Hz
Notch_50Hz:
  normalized_freq: 50 / 80 = 0.625
  Q: 30
  # ç³»æ•°éœ€è¦é‡æ–°è®¡ç®—
```

### 4.2 LOD é‡‘å­—å¡”å±‚æ•°è°ƒæ•´

```yaml
# åŸæ–¹æ¡ˆ (120Hz, 72h)
lod:
  max_samples: 31,104,000  # 120 * 3600 * 72
  max_levels: 25

# æ›´æ–°å (160Hz, 72h)
lod:
  max_samples: 41,472,000  # 160 * 3600 * 72
  max_levels: 26           # ceil(log2(41472000)) = 26
```

---

## äº”ã€ä¼ªè¿¹æ£€æµ‹é˜ˆå€¼è°ƒæ•´

```yaml
# åŸæ–¹æ¡ˆ (120Hz)
gap:
  interpolate_max: 3 samples  # 25ms
  mask_min: 4 samples

# æ›´æ–°å (160Hz)
gap:
  interpolate_max: 4 samples  # 25ms (160 * 0.025 = 4)
  mask_min: 5 samples

clip:
  ignore_max: 3 samples       # ~19ms
  mark_min: 4 samples

outlier:
  replace_max: 1 sample
  mask_min: 8 samples        # ~50ms (160 * 0.05 = 8)
```

---

## å…­ã€å»ºè®®çš„è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œï¼ˆé˜»å¡é¡¹ï¼‰

1. **æ›´æ–° DSP_SPEC.md**
   - é‡‡æ ·ç‡: 120 â†’ 160 Hz
   - æ»¤æ³¢å™¨å‚æ•°è¡¨ï¼ˆå¤šæ¡£ä½ï¼‰
   - ä¼ªè¿¹é˜ˆå€¼ï¼ˆåŸºäº160Hzï¼‰

2. **æ›´æ–° ARCHITECTURE.md**
   - é€šé“é…ç½®: 4 EEG + 6 NIRS
   - è§†é¢‘æ¨¡å—æ¶æ„

3. **æ›´æ–° 00_CONSTITUTION.md**
   - æ— éœ€ä¿®æ”¹ï¼ˆæ ¸å¿ƒåŸåˆ™ä¸å˜ï¼‰

### Sprint è®¡åˆ’è°ƒæ•´

| Sprint | åŸè®¡åˆ’ | è°ƒæ•´å |
|--------|--------|--------|
| S1 | 2é€šé“æ¸²æŸ“åº•åº§ | **4+6é€šé“æ¸²æŸ“åº•åº§** |
| S2 | IIRæ»¤æ³¢ + LOD | IIRæ»¤æ³¢(å¤šæ¡£ä½) + LOD(160Hz) |
| S3 | NIRSè¶‹åŠ¿ | NIRS(6é€šé“) + è§†é¢‘é›†æˆ |
| S4 | å›æ”¾ + å®¡è®¡ | å›æ”¾ + å®¡è®¡ + GSç›´æ–¹å›¾ |

---

## ä¸ƒã€æŒ‡æŒ¥å®˜å†³ç­–é¡¹

è¯·æ‚¨å†³å®šä»¥ä¸‹äº‹é¡¹ï¼š

### å†³ç­– 1: æ˜¯å¦æ¥å—å‚æ•°æ›´æ–°ï¼Ÿ

```
[ ] æ¥å—å…¨éƒ¨æ›´æ–°ï¼Œä¿®æ”¹è§„æ ¼æ–‡æ¡£
[ ] éƒ¨åˆ†æ¥å—ï¼ˆè¯·æŒ‡å®šï¼‰
[ ] æš‚ä¸æ›´æ–°ï¼Œå…ˆæŒ‰åŸæ–¹æ¡ˆå¼€å‘MVP
```

### å†³ç­– 2: è§†é¢‘åŠŸèƒ½ä¼˜å…ˆçº§ï¼Ÿ

```
[ ] Sprint 3 å¿…é¡»å®Œæˆ
[ ] å»¶ååˆ° Sprint 4
[ ] æš‚ä¸å®ç°ï¼Œåç»­ç‰ˆæœ¬
```

### å†³ç­– 3: å¤šæ¡£ä½æ»¤æ³¢å™¨ UIï¼Ÿ

```
[ ] é¦–ç‰ˆæ”¯æŒï¼Œç”¨æˆ·å¯é€‰
[ ] é¦–ç‰ˆå›ºå®šé»˜è®¤å€¼ï¼Œåç»­å¼€æ”¾
```

---

## å…«ã€é™„å½•ï¼šæ•°æ®åŒ…ç»“æ„ï¼ˆæ¥è‡ªç¤ºä¾‹ä»£ç ï¼‰

```c
// æ•°æ®åŒ…æ ¼å¼ (40 bytes total)
struct EEGPacket {
    uint8_t  header[2];     // 0xAA 0x55
    int16_t  data[18];      // 36 bytes
    // data[0]  = EEG CH1 raw
    // data[1]  = EEG CH2 raw
    // data[2]  = EEG CH3 raw
    // data[3]  = aEEG GS histogram bin (CH1)
    // data[4]  = aEEG GS histogram bin (CH2)
    // ...
    // data[9]  = Config word
    // data[16] = GS counter (0-229, 255=ignore)
    // data[17] = ...
    uint16_t crc;           // 2 bytes
};

// EEG è½¬æ¢å…¬å¼
float eeg_uV = raw_value * 0.076f;

// åŒ…é€Ÿç‡: 160 Hz
// æ³¢ç‰¹ç‡: 115200 bps
```

---

**ç­‰å¾…æ‚¨çš„å†³ç­–æŒ‡ä»¤ã€‚**
