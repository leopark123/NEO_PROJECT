# NEO aEEG + NIRS 监护系统 UI 冻结规格

> **版本**: 1.2  
> **状态**: 🔒 FROZEN（冻结）  
> **生效日期**: 2026-01-30  
> **变更规则**: 任何修改必须通过 ADR  

---

## 1. 文档状态

| 属性 | 值 |
|------|-----|
| 状态 | 🔒 Frozen |
| 适用范围 | NEO aEEG + NIRS 监护系统 UI |
| 版本 | v1.2 |

**核心原则**：
- 未写入本文件的功能 → 视为非需求
- 实现与规格冲突 → 以规格为准
- 视觉细节（颜色/字体/对话框布局） → 以 `NEO_UI_Development_Plan_WPF.md` 为准

---

## 2. UI 总体原则（不可违反）

### 2.1 UI 只展示，不推断

| 允许 | 禁止 |
|------|------|
| 显示后端/设备提供的数值 | UI 内做医学计算 |
| 显示缺失/异常状态 | UI 内补值/插值 |
| 按用户操作更新显示 | UI 内平滑/美化波形 |
| | UI 内猜测/推断数值 |

### 2.2 时间轴统一

```
全系统时间单位: int64 微秒（μs）
时间来源: 主机 Monotonic Clock
UI 不引入新的时间基准
```

### 2.3 实时与回放一致性

- 同一 UI 组件同时支持实时/回放
- 仅数据源不同，渲染逻辑完全一致

### 2.4 异常必须可视化

- 缺失/饱和/导联脱落必须有明确视觉反馈
- 禁止隐藏任何异常状态

### 2.5 所有用户操作可审计

- UI 中触发的关键操作必须写入 AuditLog

---

## 3. 支持平台与技术栈

| 项目 | 规格 |
|------|------|
| OS | Windows |
| 运行时 | .NET 9.0 |
| UI 框架 | WPF |
| 架构 | MVVM |
| 渲染 | Vortice + Direct2D |
| WPF 集成 | D3DImage |
| DPI | 必须支持高 DPI |
| 输入 | 鼠标 + 触摸屏 |

---

## 4. 主界面布局（必须实现）

### 4.1 布局结构

```
┌──────────────────────────────────────────────────────────────────────────┐
│ 顶部工具栏                                                               │
│ Logo | 进度条 | 播放/暂停 | 截图 | 标注 | 时间 | 用户 | 床位号           │
├────────┬─────────────────────────────────────────┬─────────┬─────────────┤
│ 左侧   │              波形显示区                 │ 参数    │ 视频+NIRS   │
│ 导航栏 │                                         │ 控制区  │ 区域        │
│        │  ┌─────────────────────────────────┐   │         │             │
│ 首页   │  │ aEEG 趋势区 (Ch1)               │   │ 导联    │ 视频预览    │
│ 历史   │  ├─────────────────────────────────┤   │ 选择    │             │
│ 显示   │  │ EEG 波形 (Ch1)                  │   │         │             │
│ 滤波   │  ├─────────────────────────────────┤   │ 增益    │─────────────│
│ 用户   │  │ aEEG 趋势区 (Ch2)               │   │ 选择    │             │
│ 导出   │  ├─────────────────────────────────┤   │         │ NIRS        │
│ 关机   │  │ EEG 波形 (Ch2)                  │   │ Y轴     │ 通道控制    │
│        │  ├─────────────────────────────────┤   │ 范围    │ (6通道)     │
│        │  │ NIRS 趋势区                     │   │         │             │
│        │  ├─────────────────────────────────┤   │         │             │
│        │  │ 时间轴 SeekBar                  │   │         │             │
│        │  └─────────────────────────────────┘   │         │             │
├────────┴─────────────────────────────────────────┴─────────┴─────────────┤
│ 状态栏: FPS | 存储 | EEG:● NIRS:○ Video:● | 当前时间                     │
└──────────────────────────────────────────────────────────────────────────┘
```

### 4.2 布局尺寸（冻结）

| 区域 | 尺寸 | 说明 |
|------|------|------|
| 顶部工具栏 | 高度 60px | 固定 |
| 左侧导航栏 | 宽度 60px | 固定 |
| 右侧参数面板 | 宽度 ≥150px | 最小值 |
| 右侧视频+NIRS | 宽度 ≥300px | 最小值 |
| 底部状态栏 | 高度 30px | 固定 |
| 中央波形区 | 自适应 | 填充剩余空间 |

---

## 5. 功能区规格

### 5.1 EEG 波形区（必须）

| 属性 | 规格 |
|------|------|
| 采集通道数 | 4（CH1-CH4） |
| 显示通道数 | 2（默认，可切换组合） |
| Y 轴类型 | 线性 |
| Y 轴默认范围 | ±100 μV |
| Y 轴可选范围 | ±25 / ±50 / ±100 / ±200 μV |
| X 轴默认时间窗 | 15 秒 |
| 采样率 | 160 Hz |

**支持功能**：
- 增益切换（立即生效）
- 通道组合切换
- 缺失/饱和/导联脱落可视化

**禁止**：
- UI 内做滤波
- UI 内做重采样
- UI 内做插值

### 5.2 aEEG 趋势区（必须）

| 属性 | 规格 |
|------|------|
| 显示内容 | Min/Max 包络带 |
| Y 轴类型 | 半对数 |
| Y 轴范围 | 0-200 μV |
| Y 轴映射 | 0-10 μV 线性，10-200 μV 对数 |
| X 轴默认 | 3 小时 |
| X 轴可选 | 1h / 3h / 6h / 12h / 24h |

**GS 直方图**：
- Bins 数量：230
- 刷新间隔：15 秒一列

**禁止**：
- UI 参与 aEEG 计算
- UI 生成包络数据

### 5.3 NIRS 显示区（必须）

| 属性 | 规格 |
|------|------|
| 通道数 | 6 |
| 显示值 | 设备提供的 rSO₂（%） |
| 数值格式 | "XX%" 或 "--%" |

**通道控制**：
- 每通道独立开关
- 开关状态持久化
- 关闭通道不显示趋势

**协议未定义时**：
| 状态 | 显示 |
|------|------|
| 无数据 | "--%" |
| 传感器故障 | "Fault" |
| 被阻塞 | "Blocked" |

**禁止**：
- UI 推断阈值
- UI 计算血氧
- UI 设置报警
- UI 显示模拟/估算值

### 5.4 视频预览区（必须）

| 属性 | 规格 |
|------|------|
| 来源 | USB 摄像头（UVC） |
| 时间戳 | 使用主机时间（μs） |
| 比例 | 保持原始比例 |

**支持功能**：
- 实时预览
- 回放同步（误差 ±1 秒）

**无摄像头时**：显示占位提示

---

## 6. 参数与交互

### 6.1 增益控制（必须）

| 属性 | 规格 |
|------|------|
| 档位 | 10 / 20 / 50 / 70 / 100 / 200 / 1000 μV/cm |
| 默认值 | 100 μV/cm |
| 响应时间 | < 100 ms |
| 审计 | GAIN_CHANGE |

### 6.2 滤波设置（必须）

| 滤波器 | 选项 |
|--------|------|
| 高通 (HPF) | 0.3 / 0.5 / 1.5 Hz |
| 低通 (LPF) | 15 / 35 / 50 / 70 Hz |
| 陷波 (Notch) | 50 / 60 Hz |

- UI 只发送配置，不实现滤波
- 审计：FILTER_CHANGE

### 6.3 时间轴控制（必须）

| 功能 | 规格 |
|------|------|
| 播放/暂停 | 按钮切换 |
| 拖动 Seek | SeekBar 拖动 |
| 点击跳转 | 点击 SeekBar 位置 |
| **Seek 响应时间** | **< 200 ms** |
| 多流同步 | EEG/aEEG/NIRS/Video 同步跳转 |
| 同步精度 | ±100 ms |
| 审计 | SEEK |

### 6.4 标注（必须）

- 标注类型：时间点标注
- 输入方式：文本输入
- 时间绑定：当前播放时间戳
- 审计：ANNOTATION

### 6.5 截图（必须）

- 截图范围：当前波形区
- 保存格式：PNG
- 审计：SCREENSHOT

---

## 7. 质量指示（必须）

| 状态 | UI 表现 |
|------|---------|
| 数据缺失 | 波形断裂 + 灰色背景 |
| 信号饱和 | 红色高亮 |
| 导联脱落 | 图标 + "Lead Off" + 橙色背景 |

**规则**：缺失数据**禁止插值填充**

---

## 8. 状态栏（必须）

```
FPS: 60 | 存储: 120GB/300GB | EEG:● NIRS:○ Video:● | 15:42:10
```

| 项目 | 更新频率 |
|------|----------|
| FPS | 1 秒 |
| 存储 | 1 秒 |
| 设备连接状态 | 实时 |
| 当前时间 | 1 秒 |

---

## 9. 对话框功能（必须）

> 对话框详细布局见 `NEO_UI_Development_Plan_WPF.md`

| 对话框 | 功能要求 |
|--------|----------|
| 登录 | 用户名 + 密码验证，审计 USER_LOGIN |
| 患者信息 | 住院号必填，支持疾病/孕期勾选 |
| 滤波设置 | HPF/LPF/Notch 配置 |
| 显示设置 | 扫描速度、网格显示开关 |
| 用户管理 | 需密码验证，支持 CRUD |
| 历史数据 | 按姓名/住院号查询，加载回放 |

---

## 10. 审计要求（必须）

| 操作 | 事件类型 |
|------|----------|
| 监测开始 | MONITORING_START |
| 监测结束 | MONITORING_STOP |
| 滤波参数变更 | FILTER_CHANGE |
| 增益变更 | GAIN_CHANGE |
| 时间轴 Seek | SEEK |
| 标注 | ANNOTATION |
| 截图 | SCREENSHOT |
| 用户登录 | USER_LOGIN |
| 用户登出 | USER_LOGOUT |
| 设备断开 | DEVICE_DISCONNECT |

**审计记录格式**：timestamp_us (int64) + event_type + user_id + details

---

## 11. 稳定性要求（必须）

| 指标 | 要求 |
|------|------|
| 连续运行 | ≥72 小时无崩溃 |
| 渲染帧率 | ≥60 fps 稳定 |
| 内存占用 | 无持续增长（<5% 漂移） |
| 设备断开 | UI 不崩溃 |

---

## 12. 性能要求（必须）

| 操作 | 响应时间 |
|------|----------|
| Seek 跳转 | < 200 ms |
| 参数变更 | < 100 ms |
| 对话框打开 | < 500 ms |

---

## 13. 触摸支持（必须）

| 要求 | 规格 |
|------|------|
| 触摸目标最小尺寸 | ≥44 × 44 px |
| 支持手势 | 点击、拖动 |

---

## 14. 非目标（明确排除）

| 排除项 |
|--------|
| ❌ UI 内医学算法 |
| ❌ UI 内 NIRS 推断 |
| ❌ UI 内数据修复/插值 |
| ❌ 3D / 复杂动画 |
| ❌ 多语言 |

---

## 15. 验收原则

1. 以本文件逐条对照
2. 未实现 → **FAIL**
3. 未写入 → **非需求**

---

## 附录：文档引用

| 文件 | 用途 |
|------|------|
| `UI_SPEC.md` | 功能规格（本文件）— What |
| `NEO_UI_Development_Plan_WPF.md` | 设计实现 — How |
| `CHARTER.md` | 项目宪法 |
| `PROJECT_STATEUI.md` | 唯一进度锚点 |
| `ACCEPTANCE_TESTS.md` | 验收清单 |

```
视觉规范（颜色、字体、对话框布局、控件样式）
以 NEO_UI_Development_Plan_WPF.md 为准
```

---

*UI_SPEC v1.2 - FROZEN*
